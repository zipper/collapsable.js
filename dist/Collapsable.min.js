/**
 * Collapsable.js - Vanilla JS plugin for collapsable boxes 
 * http://zipper.github.io/jquery.collapsable/
 *
 * @author Radek Šerý <radek.sery@gmail.com>
 * @license MIT
 *
 * @version 3.0.0-rc.1
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Collapsable=t()}(this,(function(){"use strict";function e(e){return e&&"object"==typeof e&&!Array.isArray(e)}function t(s,...l){if(!l.length)return s;const a=l.shift();if(e(s)&&e(a))for(const l in a)e(a[l])?(s[l]||Object.assign(s,{[l]:{}}),t(s[l],a[l])):Object.assign(s,{[l]:a[l]});return t(s,...l)}let s=0;class l{constructor(e,t){this.isExpanded=!0,this.listenersMap=[],this.collapsable=e,this.item=t,this.id=t.id||"ca-uid-"+s++;const l=t.querySelectorAll(e.options.control),a=t.querySelectorAll(e.options.box);if(!l||!a)throw new Error("Collapsable: Missing control or box element.'");this.controlElements=Array.from(l),this.controlLinkElements=[],this.boxElements=Array.from(a),this.prepareDOM(),this.addHandlers(),this.item.collapsableItem=this}prepareDOM(){const{options:e}=this.collapsable;this.item.id||(this.item.id=this.id);const t=[];this.boxElements.forEach(((e,s)=>{const l=e.id||`${this.item.id}-ca-box-${s}`;e.id=l,t.push(l)})),this.controlElements.forEach((s=>{let l;"a"===s.tagName.toLowerCase()?l=s:(l=s.querySelector("a"))||(l=document.createElement("a"),l.dataset.caCreated="true",l.href="#",l.innerHTML=s.outerHTML,s.replaceWith(l)),l.classList.add(e.classNames.link),l.setAttribute("aria-controls",t.join(" ")),"#"===l.getAttribute("href")&&l.setAttribute("href",`#${this.item.id}`),this.controlLinkElements.push(l)}))}addHandlers(){const{options:e}=this.collapsable,t=t=>{const s=t.detail.collapsableEvent??t;e.preventDefault&&t.preventDefault(),this.isExpanded?this.collapse(s,null,!1):this.expand(s,null,!1)};this.controlLinkElements.forEach((s=>{s.addEventListener(e.event,t),this.listenersMap.push({element:s,eventName:e.event,listener:t})}))}handleExpandCollapse(e,t,s){const{options:l}=this.collapsable;let a="expanded.collapsable",i=l.classNames.expanded,n=l.classNames.collapsed;"collapse"===e&&(a="collapsed.collapsable",i=l.classNames.collapsed,n=l.classNames.expanded);const o=new CustomEvent(a,{bubbles:!0,detail:{data:s,collapsableEvent:t}});this.isExpanded="expand"===e;return this.collapsable.getExtLinkById(this.id).forEach((e=>e.toggleClass(this.isExpanded))),this.controlLinkElements.forEach((t=>t.setAttribute("aria-expanded",String("expand"===e)))),this.boxElements.forEach((t=>{t.setAttribute("aria-hidden",String("expand"!==e)),"collapse"===e?t.setAttribute("hidden","true"):t.removeAttribute("hidden")})),this.item.classList.remove(n),this.item.classList.add(i),setTimeout((()=>{this.item.dispatchEvent(o)}),l.fxDuration),!0}expand(e,t,s){const{options:l}=this.collapsable,a=this.collapsable.getExpanded();if(this.collapsable.promiseOpen=!0,l.accordion&&a.length&&!a[0].collapse(e,t,s))return this.collapsable.promiseOpen=!1,!1;this.collapsable.promiseOpen=!1;const i=new CustomEvent("expand.collapsable",{bubbles:!0,detail:{data:t,collapsableEvent:e}});return this.item.dispatchEvent(i),i.defaultPrevented&&!s?(!l.collapsableAll&&l.accordion&&a[0].expand(e,t,!0),!1):this.handleExpandCollapse("expand",e,t)}collapse(e,t,s){const{options:l}=this.collapsable;if(!l.collapsableAll&&!this.collapsable.promiseOpen&&this.collapsable.getExpanded().length<2)return!1;const a=new CustomEvent("collapse.collapsable",{bubbles:!0,detail:{data:t,collapsableEvent:e}});return this.item.dispatchEvent(a),!(a.defaultPrevented&&!s)&&this.handleExpandCollapse("collapse",e,t)}isDefaultExpanded(){return this.item.classList.contains(this.collapsable.options.classNames.defaultExpanded)}destroy(){const{options:e}=this.collapsable;this.item.classList.remove(e.classNames.collapsed),this.item.classList.remove(e.classNames.expanded),delete this.item.collapsableItem,this.listenersMap.forEach((({element:e,eventName:t,listener:s})=>{e.removeEventListener(t,s)})),this.controlLinkElements.forEach((t=>{t.dataset.caCreated&&t.parentElement?t.parentElement.innerHTML=t.innerHTML:(t.classList.remove(e.classNames.link),t.removeAttribute("aria-controls"),t.removeAttribute("aria-expanded"))})),this.boxElements.forEach((e=>{e.removeAttribute("aria-hidden"),e.removeAttribute("hidden")})),this.item.dispatchEvent(new CustomEvent("destroy.collapsable",{bubbles:!0}))}}class a{constructor(e,t){if(this.collapsable=e,"a"!==t.tagName.toLowerCase())throw new Error("Collapsable: External link has to be HTMLAnchorElement.'");const s=t.getAttribute("href")?.substring(1),l=this.collapsable.getItemById(s);if(!l)throw new Error("Collapsable: External link has no associated collapsable item.'");this.extLink=t,this.collapsableItem=l,this.addHandler()}addHandler(){const{options:e}=this.collapsable;this.listener=t=>{e.externalLinks.preventDefault&&t.preventDefault(),this.collapsableItem.isExpanded?this.collapsableItem.collapse(t,null,!1):this.collapsableItem.expand(t,null,!1)},this.extLink.addEventListener("click",this.listener)}toggleClass(e){const{options:t}=this.collapsable;this.extLink.classList.toggle(t.classNames.externalLinkActive,e)}destroy(){this.listener&&this.extLink.removeEventListener("click",this.listener)}}return class{constructor(e,s){this.extLinks=[],this.items=[],this.defaultExpandedItem=[],this.defaults={control:".js-collapsable__control",box:".js-collapsable__box",event:"click",preventDefault:!0,fxDuration:0,accordion:!1,collapsableAll:!0,externalLinks:{selector:".js-collapsable-ext-link",preventDefault:!1},classNames:{link:"js-collapsable__link",expanded:"js-collapsable--expanded",collapsed:"js-collapsable--collapsed",defaultExpanded:"js-collapsable--default-expanded",externalLinkActive:"js-collapsable-ext-link--active"}},this.options=t({},this.defaults,s),this.promiseOpen=!1,e.forEach((e=>{const t=new l(this,e);t&&this.items.push(t)})),this.handleExternalLinks(),this.prepareDefaultExpanded(),this.handleDefaultExpanded()}handleExternalLinks(){const{options:e}=this;if(!e.externalLinks.selector)return;document.querySelectorAll(e.externalLinks.selector).forEach((e=>{const t=new a(this,e);t&&this.extLinks.push(t)}))}prepareDefaultExpanded(){const{options:e}=this,t=window.location.hash.substring(1),s=this.items.filter((e=>e.isDefaultExpanded())),l=t?this.items.find((e=>e.id===t)):void 0;l&&this.defaultExpandedItem.push(l),s.length&&this.defaultExpandedItem.push(...s),e.accordion&&(this.defaultExpandedItem=this.defaultExpandedItem.slice(0,1)),0!==this.defaultExpandedItem.length||e.collapsableAll||this.defaultExpandedItem.push(this.items[0])}handleDefaultExpanded(){const{options:e}=this,t=new CustomEvent("init.collapsable",{bubbles:!0}),s=!e.collapsableAll;this.defaultExpandedItem.forEach((e=>{e.expand(t,null,s)})),this.items.filter((e=>!this.defaultExpandedItem.includes(e))).forEach((e=>{e.collapse(t,null,!0)}))}getExtLinkById(e){return this.extLinks.filter((t=>t.collapsableItem.id===e))}getItemById(e){return this.items.find((t=>t.id===e))}getExpanded(){return this.items.filter((e=>e.isExpanded))}expandAll(e){const{options:t}=this;if(t.accordion&&this.getExpanded().length)return;const s=new CustomEvent("expandAll.collapsable");for(let l=0;l<this.items.length;l++){const a=this.items[l];if(a.isExpanded)continue;const i=a.expand(s,e,!1);if(t.accordion&&i)break}}collapseAll(e){const t=new CustomEvent("collapseAll.collapsable");this.getExpanded().forEach((s=>{s.collapse(t,e,!1)}))}destroy(){this.items.forEach((e=>e.destroy())),this.extLinks.forEach((e=>e.destroy()))}}}));
//# sourceMappingURL=Collapsable.min.js.map
